generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // url      = env("DATABASE_URL")
}

////////////////////
// ENUMS (Optional)
////////////////////

enum DietGoal {
  LOSE
  MAINTAIN
  GAIN
}

enum ActivityLevel {
  LOW
  MEDIUM
  HIGH
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK
}

enum PlanType {
  DEFICIT
  MAINTENANCE
  SURPLUS
}

enum ChatRole {
  USER
  ASSISTANT
  SYSTEM
}

////////////////////
// USER & PROFILE
////////////////////

model User {
  id           String         @id @default(uuid())
  email        String         @unique
  passwordHash String
  name         String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  profile      UserProfile?
  dietPlans    DietPlan[]
  weightLogs   WeightLog[]
  calorieLogs  CalorieLog[]
  chatSessions ChatSession[]
}

model UserProfile {
  id               String        @id @default(uuid())
  userId           String        @unique
  gender           String?
  birthDate        DateTime?
  heightCm         Int?
  currentWeightKg  Float?
  activityLevel    ActivityLevel?
  dietGoal         DietGoal?
  profileCompleted Boolean       @default(false)
  updatedAt        DateTime      @updatedAt

  user             User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

////////////////////
// FOOD & DIET
////////////////////

model Food {
  id                String             @id @default(uuid())
  name              String
  caloriesPer100g   Float?
  proteinPer100g    Float?
  carbsPer100g      Float?
  fatPer100g        Float?
  category          String?

  dietPlanMeals     DietPlanMeal[]
}

model DietPlan {
  id                   String            @id @default(uuid())
  userId               String
  dailyCalorieTarget   Int?
  proteinTarget        Int?
  carbsTarget          Int?
  fatTarget            Int?
  targetWeight         Float?
  planType             PlanType
  isActive             Boolean           @default(true)
  createdAt            DateTime          @default(now())

  user                 User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  meals                DietPlanMeal[]
}

model DietPlanMeal {
  id            String     @id @default(uuid())
  dietPlanId    String
  foodId        String?
  mealType      MealType
  portionGram   Int?
  calories      Float?
  protein       Float?
  carbs         Float?
  fat           Float?

  dietPlan      DietPlan  @relation(fields: [dietPlanId], references: [id], onDelete: Cascade)
  food          Food?     @relation(fields: [foodId], references: [id])
}

////////////////////
// MONITORING
////////////////////

model WeightLog {
  id        String   @id @default(uuid())
  userId    String
  weightKg  Float
  logDate   DateTime
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, logDate])
}

model CalorieLog {
  id            String   @id @default(uuid())
  userId        String
  totalCalories Int?
  logDate       DateTime
  createdAt     DateTime @default(now())

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, logDate])
}

////////////////////
// CHATBOT
////////////////////

model ChatSession {
  id        String        @id @default(uuid())
  userId    String?
  isGuest   Boolean       @default(false)
  startedAt DateTime      @default(now())

  user      User?         @relation(fields: [userId], references: [id])
  messages  ChatMessage[]
}

model ChatMessage {
  id         String     @id @default(uuid())
  sessionId String
  role       ChatRole
  content    String
  createdAt  DateTime   @default(now())

  session    ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
}

////////////////////
// RAG DOCUMENTS
////////////////////

model NutritionDocument {
  id        String   @id @default(uuid())
  title     String?
  content   String
  embedding Unsupported("vector(1536)")
  source    String?
  createdAt DateTime @default(now())
}
